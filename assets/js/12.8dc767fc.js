(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{216:function(a,t,s){"use strict";s.r(t);var e=s(3),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"laravel-라라벨-에서-propel-orm-사용하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#laravel-라라벨-에서-propel-orm-사용하기"}},[a._v("#")]),a._v(" [laravel] 라라벨 에서 Propel orm 사용하기")]),a._v(" "),s("p",[a._v("라라벨에선 기본적으로 Eloquent ORM을 지원하지만, 현재 실무 에선 Propel을 사용중이었고, propel 기반의 셋팅중 laravel+propel 관련 한글 자료가 너무 없었고,")]),a._v(" "),s("p",[a._v("공식 "),s("a",{attrs:{href:"https://github.com/propelorm/PropelLaravel",target:"_blank",rel:"noopener noreferrer"}},[a._v("propelorm/PropelLaravel"),s("OutboundLink")],1),a._v(" 패키지의 문서에 내용과도 현재 라라벨 버전업으로 지원되지 않는 부분들이 있어서, 직접 해보고 경험한 내용 및 설치 순서를 정리 해보려 한다.")]),a._v(" "),s("h2",{attrs:{id:"_0-orm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-orm"}},[a._v("#")]),a._v(" 0. ORM")]),a._v(" "),s("p",[a._v("설명 하기전에 ORM에 대해 간단하게 정리해보자면 "),s("strong",[a._v("object relational mapping")]),a._v("의 줄임말로 객체 관계 매핑 정도로 해석된다")]),a._v(" "),s("p",[a._v("즉 데이터베이스를 처리할때 쿼리빌더라 날쿼리를 쓰는게 아니라 객체지향 형태로 구성된 환경에서 쿼리를 처리할수 있는 환경을 뜻할수 있고, 오브젝트로 반환되는 값들을 이용해 연계 처리를 할수있는 등의 형태다")]),a._v(" "),s("p",[a._v("java 에선 MyBatis, node.js 에서는 MongoDB 가 있다.")]),a._v(" "),s("h2",{attrs:{id:"_1-설치"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-설치"}},[a._v("#")]),a._v(" 1. 설치")]),a._v(" "),s("p",[a._v("기준은 라라벨 5.5와 Database가 설치되고, 필요 테이블이 만들어진 이후 부터이다.")]),a._v(" "),s("p",[a._v("현재 "),s("a",{attrs:{href:"https://github.com/propelorm/PropelLaravel",target:"_blank",rel:"noopener noreferrer"}},[a._v("propelorm/PropelLaravel"),s("OutboundLink")],1),a._v(' 의 문서상에 내용대로 진행하고, 설치를 시도 해보면 propel/propel-laravel: "dev-master"이 설치되는대,\n이부분은 가장 안정성있는 최신 버전이라고 되어있지만 실제 현재 상황에서 사용해보면 버그가 발생하거나, 초기 설정이 여러 부분 필요하다.')]),a._v(" "),s("p",[a._v("해당 패키지 issues를 확인해보면, 최신 버전에 대한 이야기와 더이상 업데이트가 없냐는 이야기가 있을 정도이다. 해서 dev-develop 버전으로 사용하는 것으로 시작한다.")]),a._v(" "),s("h3",{attrs:{id:"_1-1-composer-json-파일에-패키지를-등록한다"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-composer-json-파일에-패키지를-등록한다"}},[a._v("#")]),a._v(" 1-1.composer.json 파일에 패키지를 등록한다")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("...\n"),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"require"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  ...\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"propel/propel"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^2.0@alpha"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"propel/propel-laravel"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dev-develop"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n...\n"),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"minimum-stability"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"alpha"')]),a._v("\n")])])]),s("p",[a._v("require부분에 사용할 propel과 propel provider가 포함된 propel-laravel을 추가해주고, 최소 사용가능 버전 설정을 위해 맨 아래에 minimum-stability 도 추가해 준다.")]),a._v(" "),s("p",[a._v("그다음 composer를 업데이트 한다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("composer update\n")])])]),s("h3",{attrs:{id:"_1-2-laravel-service-provider-등록"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-laravel-service-provider-등록"}},[a._v("#")]),a._v(" 1-2. Laravel service provider 등록")]),a._v(" "),s("p",[a._v("기존에 문서에보면 GeneratorServiceProvider, RuntimeServiceProvider 를 등록하라고 나오는대, 업데이트된 버전에선 한개의 provider만 등록하면 된다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/* app/config/app.php */\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'providers'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nPropel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("PropelLaravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("PropelIntegrationServiceProvider::class,\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"_1-3-propel-config-파일-복사"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-propel-config-파일-복사"}},[a._v("#")]),a._v(" 1-3. propel config 파일 복사")]),a._v(" "),s("p",[a._v("터미널(혹은 콘솔) 에서 아래의 명령어를 입력하여 config을 복사")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php ./artisan vendor:publish --provider "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Propel\\PropelLaravel\\RuntimeServiceProvider'")]),a._v("\n")])])]),s("p",[s("em",[s("strong",[a._v("단! 이 방법이 안될경우 아래의 명령어를 통해 cache초기화 등을 해준뒤 다시 진행해본다")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php artisan config:cache\ncomposer update\nphp artisan config:cache\nphp artisan vendor:publish\n")])])]),s("h2",{attrs:{id:"_2-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-설정"}},[a._v("#")]),a._v(" 2. 설정")]),a._v(" "),s("p",[a._v("설치가 다되었으면, 이제 Laravel을 설정하여 DB를 연결하고, 해당 DB테이블에 대한 schema.xml 파일을 추출한 뒤 해당 테이블과 매칭되는 모델을 propel 명령어로 생성한다.")]),a._v(" "),s("h3",{attrs:{id:"_2-1-env설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-env설정"}},[a._v("#")]),a._v(" 2-1. env설정")]),a._v(" "),s("p",[a._v("laravel DB설정을 위해 상위폴더에 env파일을 열고, 자신의 환경에 맞게 DB를 설정한다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/* 나는 homestead 를 사용하기 때문에, 그에맞게 설정"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" */\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_CONNECTION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("db.local\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_DATABASE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("homestead\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_USERNAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("homestead\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DB_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("secret\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),s("p",[a._v("그리고 env 파일이나 config 파일이 변경되면 clear 작업을 통해 새로 불러와야 한다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php artisan config:clear\n")])])]),s("h3",{attrs:{id:"_2-2-schema-xml-추출"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-schema-xml-추출"}},[a._v("#")]),a._v(" 2-2. schema.xml 추출")]),a._v(" "),s("p",[a._v("만들어진 테이블을 기반으로 schema.xml을 뽑아 내도록 한다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php artisan propel:database:reverse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("데이터베이스 커넥션 명"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mysql,default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("여기서 사용되는 데이터베이스 커넥션 명은 따로 변경하지 않았으면 default, mysql 둘중 하나일 가능 성이 크다.")]),a._v(" "),s("p",[a._v("커넥션명은 아까 복사한 config/propel.php 파일을 열어보면 connections안에 포함된 이름으로 확인 할 수 있다.")]),a._v(" "),s("h3",{attrs:{id:"_2-3-schema-xml-파일-수정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-schema-xml-파일-수정"}},[a._v("#")]),a._v(" 2-3. schema.xml 파일 수정")]),a._v(" "),s("p",[s("em",[s("strong",[a._v("이부분은 사람마다, 상황마다 다르다. 필수가 아님!")])]),a._v("\ntimestamp 컬럼에 데이터가 들어가는 시간을 자동으로 넣어 주는 부분과, 미리 모델을 만들때 namespace를 선언하기 위해 xml 파일을 수정한다")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v('...\n/* namespace="App\\Models\\" 추가 */\n'),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("database")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("defaultIdMethod")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("native"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("defaultPhpNamingMethod")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("underscore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("App\\Models\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n...\n\n/* timestamp 추가 */\n...\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("column")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("phpName")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("UserId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("INTEGER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("size")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sqlType")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("int(10) unsigned"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("required")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("behavior")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("timestampable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n...\n")])])]),s("h3",{attrs:{id:"_2-4-model-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-model-생성"}},[a._v("#")]),a._v(" 2-4. model 생성")]),a._v(" "),s("p",[a._v("만들어진 schema.xml 기반의 내용으로 laravel 모델을 생성한다.")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php artisan propel:model:build\n")])])]),s("h3",{attrs:{id:"_2-5-테스트"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-테스트"}},[a._v("#")]),a._v(" 2-5. 테스트")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php artisan tinker\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("UserQuery::create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("find"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Propel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Runtime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Collection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ObjectCollection "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("#888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"_3-정리"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-정리"}},[a._v("#")]),a._v(" 3. 정리")]),a._v(" "),s("p",[a._v("여기까지가 laravel 5.5에서 propel orm을 적용하는 방법이었다.\n실제로 github 페이지 readme.md에서 변경된건")]),a._v(" "),s("ul",[s("li",[a._v("설치방법 (1-1)")]),a._v(" "),s("li",[a._v("provider 등록 (1-2)")])]),a._v(" "),s("p",[a._v("밖에 없다. 다만, laravel+propel 환경의 셋팅 자료도 잘없고,\n나중에 필요할때 까먹지 않기 위해 정리해 보았다!")])])}),[],!1,null,null,null);t.default=r.exports}}]);